<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Devis n°{{ quote.quote_number }}</title>
</head>
<body>

<div id="content">
  <h1>Devis n°{{ quote.quote_number }}</h1>
  <p>Client : {{ quote.client.company }}</p>

  <table border="1" cellpadding="5" cellspacing="0">
    <thead>
      <tr><th>Réf.</th><th>Description</th><th>Quantité</th><th>Prix unitaire (€)</th><th>Total (€)</th></tr>
    </thead>
    <tbody>
      {% for line in initial_lines %}
      <tr>
        <td>{{ line.supplier_ref }}</td>
        <td>{{ line.description }}</td>
        <td>{{ line.quantity }}</td>
        <td>{{ "%.2f"|format(line.supplier_prices[0].price) }}</td>
        <td>{{ "%.2f"|format(line.client_price) }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<button id="exportWordBtn">Exporter en Word</button>

<script>
document.getElementById('exportWordBtn').addEventListener('click', function() {
  const content = document.getElementById('content').innerHTML;

  const header = `
    <html xmlns:o='urn:schemas-microsoft-com:office:office' 
          xmlns:w='urn:schemas-microsoft-com:office:word' 
          xmlns='http://www.w3.org/TR/REC-html40'>
    <head><title>Export Word</title></head><body>`;
  const footer = `</body></html>`;

  const sourceHTML = header + content + footer;

  const blob = new Blob(['\ufeff', sourceHTML], { type: 'application/msword' });

  const url = URL.createObjectURL(blob);
  const link = document.createElement('a');
  link.href = url;
  link.download = 'devis_{{ quote.quote_number }}.doc';
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
});
</script>

</body>
</html>
